name: Fetch data from swisstopo
#run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
run-name: Fetching data from swisstopo
#on: [push]
on: 
    schedule:
        - cron: '30 5 * * *'
    workflow_dispatch:

jobs:
  Fetch-Building-Addresses:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout the streets
        uses: actions/checkout@v4


      - run: echo "Fetching streets"
      # addresses is too big, change to streets
      - run: curl https://data.geo.admin.ch/ch.swisstopo.amtliches-strassenverzeichnis/amtliches-strassenverzeichnis/amtliches-strassenverzeichnis_2056.csv.zip -o $(date +%Y-%m-%d).csv.zip
      - run: unzip $(date +%Y-%m-%d).csv.zip
      - run: mv pure_str.csv data/street-$(date +%Y-%m-%d).csv
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Push data to repo
        env:
          COMMIT_MESSAGE: Fetching streets for $(date +%sY-%m-%d)
          COMMIT_AUTHOR: AutoFetch swisstopo
        run: |
          git config --global user.name "${{ env.COMMIT_AUTHOR }}"
          git config --global user.email "kyrandesa@users.noreply.github.com"
          git add *.csv
          git commit -m "${{env.COMMIT_MESSAGE }}"
          git push
      - run: echo "ğŸ This job's status is ${{ job.status }}."
